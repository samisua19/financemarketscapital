<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        div.input-group-prepend {
            height: 34px;
            font-size: 15px;
        }

        input.form-control,
        select.custom-select {
            font-size: 18px;
            height: 40px;
        }

        label.input-group-text,
        span.input-group-text,
        .btn {
            height: 40px;
            ;
            font-size: 18px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="row">
            </div>
            <div class="row ">
                <div class="col" style="text-align: center; margin: 10px;">
                    <h1>Bienvenido a Finance Markets Capital</h1>
                </div>
            </div>
            <div class="row">
                <div class="col" style="text-align: center; margin: 10px;">
                    <p>Su tranquilidad es nuestra prioridad. <br>
                        Contamos con la autorización de la principales autoridades reguladoras en Colombia. <br>
                        Valoramos y respetamos su privacidad. <br>
                        Sus fondos están seguros en bancos que cuentan con una gran reputación. <br>
                        <strong>Por favor llene todos los campos que aparecen a continuación:</strong> </p>
                </div>
            </div>
            <form id="registerForm">

                <div class="row">
                    <div class="col">
                        <div class="row justify-content-center" id="errors">
                            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                <div class="" id="error"></div>
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control user " placeholder="Usuario" aria-label="User"
                                aria-describedby="btnUserCheck" id="inputUser" required>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="btnUserCheck"
                                    style=" border-bottom-right-radius: 10px; border-top-right-radius: 3px ; border: 1px solid #EED2CD;">Verificar</button>
                            </div>
                            <!--
                            <small class="form-text text-muted">Debe tener al menos 10 caracteres, de los cuales al menos uno debe ser un número.</small>
                            -->
                            <div class="user" style="height: 10px;"></div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control sponsor" placeholder="Usuario quién te referenció"
                                aria-label="Patrocinador" aria-describedby="btnPatrocinadorCheck" id="inputPatrocinador"
                                title="Escriba la palabra “Nadie” si no lo hay">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="btnPatrocinadorCheck"
                                    style=" border-bottom-right-radius: 10px; border-top-right-radius: 3px ; border: 1px solid #EED2CD;">Verificar</button>
                            </div>
                            <div class="sponsor" style="height: 10px;"></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <input type="text" class="form-control" placeholder="Nombres" id="inputName" required>
                    </div>
                    <div class="col">
                        <input type="text" class="form-control" placeholder="Apellidos" id="inputLastName" required>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupTDocumento">Tipo Documento</label>
                            </div>
                            <select class="custom-select" id="inputGroupTDocumento" required>
                                <option value="">Escoger...</option>
                                <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                                <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                                <option value="NIT">NIT</option>
                                <option value="Pasaporte">Pasaporte</option>
                                <option value="Tarjeta de seguro social extranjero">Tarjeta de seguro social extranjero
                                </option>
                                <option value="Sociedad Extrangera sin nit en Colombia">Sociedad Extrangera sin nit en
                                    Colombia</option>
                                <option value="Fideicomiso">Fideicomiso</option>
                                <option value="RIF Venezuela">RIF Venezuela</option>
                                <option value="NIT Extranjería">NIT Extranjería</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <input type="text" placeholder="Numero de Documento" class="form-control" id="inputNumDocumento"
                            required>
                    </div>
                </div>

                <div class="row ">
                    <div class="col col-md-6">
                        <div class="form-inline col-md-12">
                            <h4>Fecha de Nacimiento: </h4>
                            <div class="input-group ">
                                <select class="custom-select" id="inputDay" required
                                    style="margin-left: 20px; width: 80px;">
                                    <option value="">Dia</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select>
                                <div class="input-group ">
                                    <select class="custom-select" id="inputMes" required
                                        style="margin-left: 5px; width: 80px;">
                                        <option value="">Mes</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                                <input type="text" name="inputYear" id="inputYear"
                                    style="width: 100px; margin-left: 5px;" class="form-control" placeholder="AAAA"
                                    maxlength="4">
                            </div>

                        </div>
                    </div>
                    <div class="col col-md-6">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupGender">Genero</label>
                            </div>
                            <select class="custom-select" id="inputGroupGender" required>
                                <option value="">Escoger...</option>
                                <option value="Hombre">Hombre</option>
                                <option value="Mujer">Mujer</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3" id="app">
                            <input type="email" class="form-control" placeholder="Correo Electrónico" aria-label="Email"
                                aria-describedby="btnSubmitEmail" id="inputEmail" v-model="from_email" required>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="btnSubmitEmail"
                                    @click="enviar"
                                    style=" border-bottom-right-radius: 3px; border-top-right-radius: 3px ; border: 1px solid #EED2CD;">Pedir
                                    Token</button>
                            </div>
                            <div></div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="number" class="form-control"
                                placeholder="Escriba el TOKEN recibido en el correo                            "
                                aria-label="Verify Email" aria-describedby="btnVerifyEmail" id="inputVerifyEmail"
                                required>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="btnVerifyEmail"
                                    style=" border-bottom-right-radius: 3px; border-top-right-radius: 3px ; border: 1px solid #EED2CD;">Verificar</button>
                            </div>
                            <div></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <input type="password" class="form-control" placeholder="Escriba una Contraseña fuerte
                        " id="inputPassword" minlength="8" required>
                        <small class="form-text text-muted">Su contraseña debe ser de 8 caracteres o más, contener
                            mayúsculas y números.</small>
                    </div>
                    <div class="col">
                        <input type="password" class="form-control" placeholder="Confirme su Contraseña"
                            id="inputConfirmPassword" minlength="8" required>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <select class="custom-select" id="inputState" required>
                                <option value="">Departamento</option>
                                <option value="Amazonas">Amazonas</option>
                                <option value="Antioquia">Antioquía</option>
                                <option value="Arauca">Arauca</option>
                                <option value="Atlántico">Atlántico</option>
                                <option value="Bolívar">Bolívar</option>
                                <option value="Boyacá">Boyacá</option>
                                <option value="Caldas">Caldas</option>
                                <option value="Caquetá">Caquetá</option>
                                <option value="Casanare">Casanare</option>
                                <option value="Cauca">Cauca</option>
                                <option value="Cesar">Cesar</option>
                                <option value="Chocó">Chocó</option>
                                <option value="Córdoba">Córdoba</option>
                                <option value="Cundinamarca">Cundinamarca</option>
                                <option value="Guainía">Guainía</option>
                                <option value="Huila">Huila</option>
                                <option value="La Guajira">La Guajira</option>
                                <option value="Magdalena">Magdalena</option>
                                <option value="Meta">Meta</option>
                                <option value="Nariño">Nariño</option>
                                <option value="Norte de Santander">Norte de Santander</option>
                                <option value="Putumayo">Putumayo</option>
                                <option value="Quindío">Quindío</option>
                                <option value="Risaralda">Risaralda</option>
                                <option value="San Andres y Providencia">San Andrés y Providencia</option>
                                <option value="Santander">Santander</option>
                                <option value="Sucre">Sucre</option>
                                <option value="Tolima">Tolima</option>
                                <option value="Valle del Cauca">Valle del Cauca</option>
                                <option value="Vaupés">Vaupés</option>
                                <option value="Vichada">Vichada</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <select class="custom-select" id="inputCity" required>
                                <option value="">Ciudad</option>
                            </select>
                        </div>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <input type="text" placeholder="Dirección" class="form-control" id="inputDireccion" required>
                    </div>
                    <div class="col">
                        <input type="text" placeholder="Número con Whatsapp" class="form-control" id="inputNumber"
                            required>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="imageCedula" lang="es" required>
                            <label class="custom-file-label" for="imageCedula">Imagen Identificación (Frontal)</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="imageRespaldoCedula" lang="es" required>
                            <label class="custom-file-label" for="imageRespaldoCedula">Imagen Identificación
                                (Respaldo)</label>
                        </div>
                    </div>

                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="imageSelfiDocumento" lang="es" required>
                            <label class="custom-file-label" for="imageSelfiDocumento">Selfie con Documento de
                                Identificación</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="imageRecibo" lang="es" required>
                            <label class="custom-file-label" for="imageRecibo">Foto de recibo donde vive</label>
                        </div>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <h4 for="" class="">Entidad financiera donde desea recibir sus pagos:
                        </h4>
                    </div>
                    <div class="col">
                        <input type="text" placeholder="Nombre de la entidad" class="form-control" id="inputNomEntidad"
                            required>
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupTCuenta">Tipo Cuenta</label>
                            </div>
                            <select class="custom-select" id="inputGroupTCuenta" required>
                                <option value="">Escoger...</option>
                                <option value="Ahorros">Ahorros</option>
                                <option value="Corriente">Corriente</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <input type="text" placeholder="Numero de Cuenta" class="form-control" id="inputNumCuenta"
                            required>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupPlazo">Plazo</label>
                            </div>
                            <select class="custom-select" id="inputGroupPlazo" required>
                                <option value="">Escoger...</option>
                                <option value="Corto Plazo">Corto Plazo</option>
                                <option value="Mediano Plazo">Mediano Plazo</option>
                                <option value="Largo Plazo">Largo Plazo</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupPlan">Plan</label>
                            </div>
                            <select class="custom-select" id="inputGroupPlan" required>
                                <option selected>Escoger...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="btnPago">
                </div>

                <div class="row">
                    <div class="col">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="customCheckTYC" required>
                            <label class="custom-control-label" for="customCheckTYC">Confirmo que acepto los Términos y
                                Condiciones del contrato
                            </label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="customCheckAuthData" required>
                            <label class="custom-control-label" for="customCheckAuthData">Autorizo el uso y tratamiento
                                de mis datos personales
                            </label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="customCheckPP" required>
                            <label class="custom-control-label" for="customCheckPP">Confirmo que acepto la política de
                                privacidad
                            </label>
                        </div>
                    </div>
                </div>
                <br>

                <div class="row justify-content-center">
                    <button class="btn btn-primary btn-lg" id="btnSubmit" type="submit">Enviar</button>
                </div>

            </form>

            <button class="btn btn-primary btn-lg" id="btnPrueba" type="button" style="display: none;">Prueba</button>
            <input type="text" id="inputExistData" style="display: none;">
            <div class="row justify-content-center">

            </div>
        </div>
    </div>
</body>

<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-storage.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js">
</script>

<script src="https://cdn.emailjs.com/dist/email.min.js" type="text/javascript">
</script>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyCPvLMdAYWqdYLAZK28AbBa56mIAo1JkxU",
        authDomain: "appfinancemarketscapital.firebaseapp.com",
        databaseURL: "https://appfinancemarketscapital.firebaseio.com",
        projectId: "appfinancemarketscapital",
        storageBucket: "gs://appfinancemarketscapital.appspot.com",
        messagingSenderId: "327823603780",
        appId: "1:327823603780:web:506199709abac99322a411",
        measurementId: "G-3V5TM2M89C"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.firestore();
    const dbStorage = firebase.storage().ref();

    const registerFrom = document.getElementById('registerForm');
    const existData = document.getElementById('inputExistData');
    const btnUserCheck = document.getElementById('btnUserCheck');
    const btnPatrocinadorCheck = document.getElementById('btnPatrocinadorCheck');
    const btnVerifyEmail = document.getElementById('btnVerifyEmail');
    const selectPlazo = document.getElementById('inputGroupPlazo');
    const selectPlan = document.getElementById('inputGroupPlan');
    const divBtnPago = document.getElementById('btnPago');
    const btnSubmit = document.getElementById('btnSubmit2');
    const divErrors = document.getElementById('errors');
    const divError = document.getElementById('error');
    const selectDepartamento = document.getElementById('inputState');
    const selectCiudad = document.getElementById('inputCity');
    const divCheckUser = document.getElementsByClassName("user")[1];
    const inputUser = document.getElementsByClassName("user")[0];
    const divChecksponsor = document.getElementsByClassName("sponsor")[1];
    const inputsponsor = document.getElementsByClassName("sponsor")[0];

    let key = ''; //llave con la que se busca el registro
    let data = ''; // dato con la que se busca el registro
    let exist = ''; // determina si el registro existe
    let datos = ''; //Almacena la respuesta de la busqueda
    let numVerify; // numero de verificacion de email
    let plazo; // plazo del plan
    let plan;
    let filtro; // Filtro del plan
    let existUser = false;
    let existSponsor = false;
    let correoVerificado = false;
    let verifyToken = false;
    let errs = [];
    let registrar = false;



    const getUsers = () => db.collection('Users').get();
    const planes = (callback) => db.collection('Planes').doc('5popKkRNj8G6bnFLxF7m').collection(plazo).orderBy(filtro, "asc").onSnapshot(callback);
    const numRandom = () => Math.floor(Math.random() * (1000000 - 100000)) + 100000;

    $(document).ready(function () {
        registerFrom['inputVerifyEmail'].disabled = true;
        btnVerifyEmail.disabled = true;
        divErrors.style.display = "none";
    });

    function dataExist(key, data) {
        db.collection("Users").where(key, "==", data)
            .get()
            .then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    datos = doc.data();
                    existData.value = datos[key];
                });
            })
            .catch(function (error) {
                console.log("Error getting documents: ", error);
            });
        setTimeout(waitDatos, 1000);
    }

    function waitDatos() {
        existData.value == '' ? exist = false : exist = true;
    }

    function saveDateUser(usuario, patrocinador, nombre, apellido, tipodocumento, numerodocumento, fecha_nac, genero, correo, password, pais, departamento, ciudad, direccion, numero, entidadFinanciera, tipocuenta, numCuenta, estado) {
        db.collection('Users').doc().set({ usuario, patrocinador, nombre, apellido, tipodocumento, numerodocumento, fecha_nac, genero, correo, password, pais, departamento, ciudad, direccion, numero, entidadFinanciera, tipocuenta, numCuenta, estado });
    }

    function savePagoUser(cedula, termino, plan) {
        db.collection('PlanesUsuarios').doc().set({ cedula, termino, plan });
    }

    function waitUser() {
        existUser = !exist;
        if (existUser) {
            inputUser.className = '';
            divCheckUser.className = '';
            divCheckUser.innerHTML = '';
            inputUser.className += 'form-control is-valid user';
            divCheckUser.className += 'user valid-feedback';
            divCheckUser.innerHTML += '<p>Este usuario esta disponible</p>';
        } else {
            inputUser.className = '';
            divCheckUser.className = '';
            divCheckUser.innerHTML = '';
            inputUser.className += 'form-control is-invalid user';
            divCheckUser.className += 'user invalid-feedback';
            divCheckUser.innerHTML += '<p>Escoge otro nombre de usuario</p>';
        }
        existData.value = '';
        exist = '';
        datos = '';
    }

    function waitSponsor() {
        existSponsor = exist;
        if (existSponsor) {
            inputsponsor.className = '';
            divChecksponsor.className = '';
            divChecksponsor.innerHTML = '';
            inputsponsor.className += 'form-control is-valid sponsor';
            divChecksponsor.className += 'sponsor valid-feedback';
            divChecksponsor.innerHTML += '<p>' + datos['nombre'] + ' ' + datos['apellido'] + '</p>';

        } else {
            inputsponsor.className = '';
            divChecksponsor.className = '';
            divChecksponsor.innerHTML = '';
            inputsponsor.className += 'form-control is-invalid sponsor';
            divChecksponsor.className += 'sponsor invalid-feedback';
            divChecksponsor.innerHTML += '<p>El patrocinador no existe</p>';
        }
        existData.value = '';
        exist = '';
        datos = '';
    }

    function confirPassword() {
        if (registerFrom['inputPassword'].value == registerFrom['inputConfirmPassword'].value) {
            return true;
        } else {
            return false;
        }
    }

    function hashPassword() {
        let passwordHash = CryptoJS.SHA256(registerFrom['inputPassword'].value);
        return passwordHash.toString(CryptoJS.enc.Base64);
    }

    function verifyErrors() {
        let registrar;
        errs = [];
        if (!existSponsor) {
            errs.push('No se ha verificado el Patrocinador');
        }
        if (!existUser) {
            errs.push('No se ha verificado el Usuario');
        }
        if (!correoVerificado) {
            errs.push('No se ha verificado el Correo');
        }
        if (!verifyToken) {
            errs.push('No se ha verificado el Token');
        }
        if (!registerFrom['customCheckPP'].checked) {
            errs.push('No has aceptado las politicas de privacidad');
        }
        if (!registerFrom['customCheckAuthData'].checked) {
            errs.push('No has autorizado el tratamiento de tus datos');
        }
        if (!registerFrom['customCheckTYC'].checked) {
            errs.push('No has aceptado los terminos y condiciones');
        }
        if (!confirPassword()) {
            errs.push('Las contraseñas no coinciden');
        }
        if (!/[a-z]/.test(registerFrom['inputPassword'].value)) {
            errs.push(' La contraseña no contiene minúsculas');
        }
        if (!/[A-Z]/.test(registerFrom['inputPassword'].value)) {
            errs.push('La contraseña no contiene mayúsculas');
        }
        if (!/[0-9]/.test(registerFrom['inputPassword'].value)) {
            errs.push('La contraseña no contiene dígitos');
        }
        if (registerFrom['inputPassword'].value.length < 8) {
            errs.push('La contraseña tiene menos de 8 caracteres');
        }
        errs.length == 0 ? registrar = true : registrar = false;
        return registrar
    }

    function writeErrors() {
        errs.forEach(err => {
            divError.innerHTML += '<p>' + err + '</p>';
            divErrors.style.display = "block";
        });

    }

    btnUserCheck.addEventListener('click', async (e) => {
        await dataExist("usuario", registerFrom['inputUser'].value);
        setTimeout(waitUser, 2000);
    });

    btnPatrocinadorCheck.addEventListener('click', async (e) => {
        if (registerFrom['inputPatrocinador'].value == '') {

            await dataExist("usuario", 'principal');
            setTimeout(waitSponsor, 2000);
            existData.value = '';
            exist = '';
            datos = '';
        } else {
            await dataExist("usuario", registerFrom['inputPatrocinador'].value);
            setTimeout(waitSponsor, 2000);
            existData.value = '';
            exist = '';
            datos = '';
        }
    });

    btnVerifyEmail.addEventListener('click', (e) => {
        if (numVerify == registerFrom['inputVerifyEmail'].value) {
            alert('los numeros coinciden');
            registerFrom['inputVerifyEmail'].disabled = true;
            btnVerifyEmail.disabled = true;
            verifyToken = true;
        } else {
            alert('los numeros no coinciden');
            verifyToken = false;
        }
    });

    selectPlazo.addEventListener('change', async (e) => {
        plazo = registerFrom['inputGroupPlazo'].value;
        if (plazo == 'Largo Plazo') {
            filtro = "meses";
        } else {
            filtro = "porcentaje";
        }
        selectPlan.innerHTML = '<option selected>Escoger...</option>';
        await planes((querySnapshot) => {
            querySnapshot.forEach(doc => {
                plan = doc.data();
                selectPlan.innerHTML += '<option value="' + plan['nombre'] + '">' + plan['nombre'] + '</option>'
            });
        });
    });

    selectPlan.addEventListener('change', (e) => {
        let dat;
        db.collection('Planes').doc('5popKkRNj8G6bnFLxF7m').collection(plazo).where("nombre", "==", selectPlan.value)
            .get()
            .then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    dat = doc.data();
                    divBtnPago.innerHTML = '';
                    divBtnPago.innerHTML += '<div class="row justify-content-center"><div class="col">' +
                        '<div class="alert alert-success" role="alert" >' +
                        '<h4 class="alert-heading">Plan a ' + plazo + '</h4>' +
                        '<p>Estas a punto de adquirir un ' + dat['nombre'] + ' a ' + plazo + ', el porcentaje de ganacia es ' + dat['porcentaje'] + '% al mes y una permanencia de ' + dat['retiro'] + '</p></div></div></div>'
                    ' <hr>';
                });
            })
            .catch(function (error) {
                console.log("Error getting documents: ", error);
            });
    });

    selectDepartamento.addEventListener('change', async (e) => {
        let state = registerFrom['inputState'].value;

        if (state == 'San Andres y Providencia') {
            selectCiudad.innerHTML = '<option selected>Ciudad</option>';
            selectCiudad.innerHTML += '<option value="Providencia y Santa Catalina Islas">Providencia y Santa Catalina Islas</option>';
            selectCiudad.innerHTML += '<option value="San Andrés">San Andrés</option>';

        } else {

            $.ajax({
                url: "https://www.datos.gov.co/resource/xdk5-pm3f.json?departamento=" + state,
                type: "GET",
                data: {
                    "$limit": 5000,
                    "$$app_token": "GMXI98X0wZcYynTBC1aLXdoPO"
                }
            }).done(function (data) {
                selectCiudad.innerHTML = '<option selected>Ciudad</option>';
                data.forEach(doc => {
                    selectCiudad.innerHTML += '<option value="' + doc['municipio'] + '">' + doc['municipio'] + '</option>';
                })
            });
        }
    });


    registerFrom.addEventListener('submit', async (e) => {
        e.preventDefault();
        let enviar = verifyErrors();
        divError.innerHTML = '';
        divErrors.style.display = "none";

        if (!enviar) {
            writeErrors();
        } else {
            let existUser = false;
            let existSponsor = false;
            let correoVerificado = false;
            let verifyToken = false;
            let errs = [];
            let registrar = false;
            waitUser();
            waitSponsor();
            let usuario = registerFrom['inputUser'].value;
            let patrocinador = registerFrom['inputPatrocinador'].value;
            let nombre = registerFrom['inputName'].value;
            let apellido = registerFrom['inputLastName'].value;
            let tipodocumento = registerFrom['inputGroupTDocumento'].value;
            let numerodocumento = registerFrom['inputNumDocumento'].value;
            let fecha_nac = registerFrom['inputDay'].value + '/' + registerFrom['inputMes'].value + '/' + registerFrom['inputYear'].value;
            let genero = registerFrom['inputGroupGender'].value;
            let correo = registerFrom['inputEmail'].value;
            let password = hashPassword();
            let pais = "Colombia";
            let departamento = registerFrom['inputState'].value;
            let ciudad = registerFrom['inputCity'].value;
            let direccion = registerFrom['inputDireccion'].value;
            let numero = "+57 " + registerFrom['inputNumber'].value;
            let entidadFinanciera = registerFrom['inputNomEntidad'].value;
            let tipocuenta = registerFrom['inputGroupTCuenta'].value;
            let numCuenta = registerFrom['inputNumCuenta'].value;
            let termino = registerFrom['inputGroupPlazo'].value;
            let plan = registerFrom['inputGroupPlan'].value;
            let estado = true;
            let urlCedula = loadImage('imagenes/', 'cedula' + numerodocumento, 'imageCedula');
            let urlRespaldoCedula = loadImage('imagenes/', 'Respaldocedula' + numerodocumento, 'imageRespaldoCedula');
            let urlSelfi = loadImage('imagenes/', 'selfi' + numerodocumento, 'imageSelfiDocumento');
            let urlRecibo = loadImage('imagenes/', 'recibo' + numerodocumento, 'imageRecibo');
            await saveDateUser(usuario, patrocinador, nombre, apellido, tipodocumento, numerodocumento, fecha_nac, genero, correo, password, pais, departamento, ciudad, direccion, numero, entidadFinanciera, tipocuenta, numCuenta, estado);
            alert('Se ha registrado correctamente');
            registerFrom.reset();
        }
    });

</script>

<script>
    (function () {
        emailjs.init("user_USX4M3dWIjUrxE8B3FICN");
    })();
    const vue = new Vue({
        el: '#app',
        data() {
            return {
                from_name: '',
                from_email: '',
                message: '',
                subject: '',
            }
        },
        methods: {
            async enviar() {

                numVerify = numRandom();
                let data = {
                    from_name: registerFrom['inputName'].value + ' ' + registerFrom['inputLastName'].value,
                    from_email: registerFrom['inputEmail'].value,
                    message: numVerify,
                    subject: "Verificacion de correo",
                };
                await dataExist("correo", registerFrom['inputEmail'].value);
                setTimeout(function () {
                    correoVerificado = exist;
                    if (correoVerificado) {
                        alert('El correo ingresado ya ha sido Registrado');
                        correoVerificado = false;
                        exist = false;
                    } else {
                        registerFrom['inputVerifyEmail'].disabled = false;
                        btnVerifyEmail.disabled = false;
                        emailjs.send("service_rzi8owg", "template_ezx2066", data)
                            .then(function (response) {
                                if (response.text === 'OK') {
                                    alert('El correo se ha enviado de forma exitosa');
                                    correoVerificado = true;
                                    exist = '';
                                }
                                console.log("SUCCESS. status=%d, text=%s", response.status, response.text);
                            }, function (err) {
                                alert('Ocurrió un problema al enviar el correo');
                                console.log("FAILED. error=", err);
                            });
                    }
                    existData.value = '';
                    exist = '';
                    datos = '';
                }, 4000);


            }
        }
    });
</script>

<script>

    let inputFile = document.getElementById('btnPrueba');
    let url;
    let fileList;
    let loadImages;
    inputFile.addEventListener('click', (e) => {

        //let urlCedula = loadImage('imagenes/', 'cedula', 'imageCedula');
        //let urlRespaldoCedula = loadImage('imagenes/', 'Respaldocedula', 'imageRespaldoCedula');
        //let urlSelfi = loadImage('imagenes/', 'selfi', 'imageSelfiDocumento');
        //let urlRecibo = loadImage('imagenes/', 'recibo', 'imageRecibo');
        //console.log(urlCedula,urlRecibo,urlSelfi,urlRespaldoCedula);
    });


    function loadImage(ubicacion, name, inputImage) {
        let inputFile = document.getElementById(inputImage);
        fileList = inputFile.files[0];
        loadImages = dbStorage.child(ubicacion + name).put(fileList);
        loadImages.on('state_changed', function (snapshot) {
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            switch (snapshot.state) {
                case firebase.storage.TaskState.PAUSED: // or 'paused'
                    console.log('Upload is paused');
                    break;
                case firebase.storage.TaskState.RUNNING: // or 'running'
                    console.log('Upload is running');
                    break;
            }
        }, function (error) {
        }, function () {
            loadImages.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                //console.log(downloadURL);
            });
        });
    }


</script>

</html>