<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <style>
        select.custom-select {
            height: 34px;
            font-size: 15px;
        }

        div.input-group-prepend {
            height: 34px;
            font-size: 15px;
        }

        label.input-group-text,
        span.input-group-text,
        .btn {
            font-size: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">
            <form id="registerForm">
                <div class="row " style="justify-content: center;">
                    <div class="col">
                        <h3> Formulario de Registro</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control user " placeholder="User" aria-label="User"
                                aria-describedby="btnUserCheck" id="inputUser">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="btnUserCheck">Check</button>
                            </div>
                            <div class="user"></div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control sponsor" placeholder="Patrocinador" aria-label="Patrocinador"
                                aria-describedby="btnPatrocinadorCheck" id="inputPatrocinador">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button"
                                    id="btnPatrocinadorCheck">Check</button>
                            </div>
                            <div class="sponsor"></div>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col">
                        <input type="text" class="form-control" placeholder="Name" id="inputName">
                    </div>
                    <div class="col">
                        <input type="text" class="form-control" placeholder="Lastname" id="inputLastName">
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupTDocumento">Tipo Documento</label>
                            </div>
                            <select class="custom-select" id="inputGroupTDocumento">
                                <option selected>Choose...</option>
                                <option value="Cedula">Cedula</option>
                                <option value="Pasaporte">Pasaporte</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <input type="number" placeholder="Numero de Documento" class="form-control"
                            id="inputNumDocumento">
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="spanBirthday" style="height: 38px;">Birthday</span>
                            </div>
                            <input type="date" class="form-control" aria-label="Birthday"
                                aria-describedby="spanBirthday" id="inputDateBirthday">
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupGender">Gender</label>
                            </div>
                            <select class="custom-select" id="inputGroupGender">
                                <option selected>Choose...</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Email" aria-label="Email"
                                aria-describedby="btnSubmitEmail" id="inputEmail">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button"
                                    id="btnSubmitEmail">Submit</button>
                            </div>
                            <div></div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Verify Email" aria-label="Verify Email"
                                aria-describedby="btnVerifyEmail" id="inputVerifyEmail">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button"
                                    id="btnVerifyEmail">Verify</button>
                            </div>
                            <div></div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 15px;">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupTCuenta">Tipo Cuenta</label>
                            </div>
                            <select class="custom-select" id="inputGroupTCuenta">
                                <option selected>Choose...</option>
                                <option value="Ahorros">Ahorros</option>
                                <option value="Corriente">Corriente</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <input type="number" placeholder="Numero de Cuenta" class="form-control" id="inputNumCuenta">
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <input type="number" placeholder="Number" class="form-control" id="inputNumber">
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupCountry">Country</label>
                            </div>
                            <select class="custom-select" id="inputGroupCountry">
                                <option selected>Choose...</option>
                                <option value="Colombia">Colombia</option>
                                <option value="EE.UU">EE.UU</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupState">State</label>
                            </div>
                            <select class="custom-select" id="inputGroupState">
                                <option selected>Choose...</option>
                                <option value="Santander">Santander</option>
                                <option value="Cundinamarca">Cundinamarca</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupCity">City</label>
                            </div>
                            <select class="custom-select" id="inputGroupCity">
                                <option selected>Choose...</option>
                                <option value="Bucaramanga">Bucaramanga</option>
                                <option value="Bogota">Bogota</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <button class="btn btn-primary btn-lg" id="btnSubmit" type="submit">Submit</button>
                </div>
            </form>
            <input type="text" id="inputExistData" style="display: none;">
            
        </div>
    </div>
</body>
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>

<script>
    var firebaseConfig = {
        apiKey: "AIzaSyCPvLMdAYWqdYLAZK28AbBa56mIAo1JkxU",
        authDomain: "appfinancemarketscapital.firebaseapp.com",
        databaseURL: "https://appfinancemarketscapital.firebaseio.com",
        projectId: "appfinancemarketscapital",
        storageBucket: "appfinancemarketscapital.appspot.com",
        messagingSenderId: "327823603780",
        appId: "1:327823603780:web:506199709abac99322a411",
        measurementId: "G-3V5TM2M89C"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const db = firebase.firestore();

    const registerFrom = document.getElementById('registerForm');
    const existData = document.getElementById('inputExistData');
    const btnUserCheck = document.getElementById('btnUserCheck');
    const btnPatrocinadorCheck = document.getElementById('btnPatrocinadorCheck');
    const divCheckUser = document.getElementsByClassName("user")[1];
    const inputUser = document.getElementsByClassName("user")[0];
    const divChecksponsor = document.getElementsByClassName("sponsor")[1];
    const inputsponsor = document.getElementsByClassName("sponsor")[0];

    let key = '';
    let data = '';
    let exist = '';
    let datos = '';

    const getUsers = () => db.collection('Users').get();

    function dataExist(key, data) {
        db.collection("Users").where(key, "==", data)
            .get()
            .then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    datos = doc.data();
                    existData.value = datos[key];
                });
            })
            .catch(function (error) {
                console.log("Error getting documents: ", error);
            });
        setTimeout(waitDatos,1000);
    }

    function waitDatos(){
        existData.value == '' ? exist = false : exist = true;
    }

    $(document).ready(function () {

    });

    function saveDateUser(user, sponsor, name, lastname, tDocument, numDocument, birthday, gender, email, tAccount, numAccount, number, country, status, city) {
        db.collection('Users').doc().set({
            user, sponsor, name, lastname, tDocument, birthday, gender, email, tAccount, numAccount, number, country, state, city, numDocument
        });
    }

    function waitUser(){
        if (exist) {
            inputUser.className = '';
            divCheckUser.className = '';
            divCheckUser.innerHTML = '';
            inputUser.className += 'form-control is-invalid user';
            divCheckUser.className += 'user invalid-feedback';
            divCheckUser.innerHTML += '<p>Escoge otro nombre de usuario</p>';
        } else {
            inputUser.className = '';
            divCheckUser.className = '';
            divCheckUser.innerHTML = '';
            inputUser.className += 'form-control is-valid user';
            divCheckUser.className += 'user valid-feedback';
            divCheckUser.innerHTML += '<p>Este usuario esta disponible</p>';
        }
    }
    function waitSponsor(){
        if (exist) {
            inputsponsor.className = '';
            divChecksponsor.className = '';
            divChecksponsor.innerHTML = '';
            inputsponsor.className += 'form-control is-valid sponsor';
            divChecksponsor.className += 'sponsor valid-feedback';
            divChecksponsor.innerHTML += '<p>'+ datos['name'] +' '+ datos['lastname'] +'</p>';
        } else {
            inputsponsor.className = '';
            divChecksponsor.className = '';
            divChecksponsor.innerHTML = '';
            inputsponsor.className += 'form-control is-invalid sponsor';
            divChecksponsor.className += 'sponsor invalid-feedback';
            divChecksponsor.innerHTML += '<p>El patrocinador no existe</p>';
        }
    }

    btnUserCheck.addEventListener('click', async (e) => {
        await dataExist("user", registerFrom['inputUser'].value);
        setTimeout(waitUser,2000);
        existData.value = '';
        exist = '';
        datos = '';
    });
    
    btnPatrocinadorCheck.addEventListener('click', async (e) => {
        await dataExist("user", registerFrom['inputPatrocinador'].value);
        
        setTimeout(waitSponsor,2000);
        existData.value = '';
        exist = '';
        datos = '';
    });



    registerFrom.addEventListener('submit', async (e) => {
        e.preventDefault();
        user = registerFrom['inputUser'].value;
        sponsor = registerFrom['inputPatrocinador'].value;
        name = registerFrom['inputName'].value;
        lastname = registerFrom['inputLastName'].value;
        tDocument = registerFrom['inputGroupTDocumento'].value;
        numDocument = registerFrom['inputNumDocumento'].value;
        birthday = registerFrom['inputDateBirthday'].value;
        gender = registerFrom['inputGroupGender'].value;
        email = registerFrom['inputEmail'].value;
        tAccount = registerFrom['inputGroupTCuenta'].value;
        numAccount = registerFrom['inputNumCuenta'].value;
        number = registerFrom['inputNumber'].value;
        country = registerFrom['inputGroupCountry'].value;
        state = registerFrom['inputGroupState'].value;
        city = registerFrom['inputGroupCity'].value;
        //await saveDateUser(user,sponsor,name,lastname,tDocument,numDocument,birthday,gender,email,tAccount,numAccount,number, country,status,city);
    });

</script>

</html>