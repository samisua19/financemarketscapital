<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

</head>

<body>
  <div class="container" style="margin-top: 10px;">
    <div class="table-responsive">
      <table id="tableUsers" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th class="th-sm">Nombre
            </th>
            <th class="th-sm">Apellido
            </th>
            <th class="th-sm"># Documento
            </th>
            <th class="th-sm">Novedad de pago
            </th>
            <th class="th-sm">Fecha Pago
            </th>
            <th class="th-sm"># Recibo
            </th>
          </tr>
        </thead>
        <tbody id="myTable">
        </tbody>
        <tfoot>
          <tr>
            <th>Nombre
            </th>
            <th>Apellido
            </th>
            <th># Documento
            </th>
            <th>Novedad de pago
            </th>
            <th>Fecha Pago
            </th>
            <th># Recibo
            </th>
          </tr>
        </tfoot>
      </table>
    </div>

  </div>
  </div>
</body>
<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-storage.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js">
</script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyCPvLMdAYWqdYLAZK28AbBa56mIAo1JkxU",
    authDomain: "appfinancemarketscapital.firebaseapp.com",
    databaseURL: "https://appfinancemarketscapital.firebaseio.com",
    projectId: "appfinancemarketscapital",
    storageBucket: "gs://appfinancemarketscapital.appspot.com",
    messagingSenderId: "327823603780",
    appId: "1:327823603780:web:506199709abac99322a411",
    measurementId: "G-3V5TM2M89C"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  const db = firebase.firestore();
  const dbStorage = firebase.storage().ref();

  $(document).ready(function () {
    //tableData.DataTable();
    setTimeout(function (){getUsers();},3000)
    //
  });

  const consultContainer = document.getElementById('myTable');
  const tableData = document.getElementById('tableUsers');


  //let data = [];


  const btnPrueba = document.getElementById('btnPrueba');
  const onGetUsers = (callback) => db.collection("Users").orderBy("fechaRegistro", "desc").onSnapshot(callback);

  function getUsers() {
    onGetUsers((querySnapshot) => {
      consultContainer.innerHTML = '';
      querySnapshot.forEach(doc => {
        let data = doc.data();
        let datos;
        if(data['estado']){
          db.collection("PlanesUsuarios").where('cedula', "==", data['numerodocumento'])
            .get()
            .then(function (querySnapshot) {
                querySnapshot.forEach(function (dat) {
                  datos = dat.data();
                });
            })
            .catch(function (error) {
                console.log("Error getting documents: ", error);
            });
            setTimeout(function(){
              consultContainer.innerHTML += '<tr> <td>'+ data['nombre'] +'</td><td>'+ data['apellido'] +'</td><td>'+ data['numerodocumento'] +'</td><td>'+ datos['estadoPago'] +'</td><td>'+ datos['fechaPago'] +'</td><td>'+ datos['recibo'] +'</td> </tr>';
            },1000);
        }
      });
      setTimeout(function(){
        $('#tableUsers').DataTable();
      },1500);
    });
  }


    
   


</script>



</html>